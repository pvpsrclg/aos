slip N0 24

Q.1) Print the type of file and inode number where file name accepted through 
Command Line [10 Marks ]
----------------------------- 
#include <stdio.h> 
#include <sys/stat.h> 
const char* file_type(mode_t mode) { 
if (S_ISREG(mode))  return "Regular File"; 
if (S_ISDIR(mode))  return "Directory"; 
if (S_ISCHR(mode))  return "Character Device"; 
if (S_ISBLK(mode))  return "Block Device"; 
if (S_ISFIFO(mode)) return "FIFO/Pipe"; 
if (S_ISLNK(mode))  return "Symbolic Link"; 
if (S_ISSOCK(mode)) return "Socket"; 
return "Unknown"; 
} 
int main(int argc, char *argv[]) { 
if (argc != 2) { 
printf("Usage: %s <file_name>\n", argv[0]); 
return 1; 
} 
struct stat st; 
if (stat(argv[1], &st) != 0) { 
perror("stat"); 
return 1; 
} 
printf("File: %s\nType: %s\nInode: %lu\n", 
argv[1], 
f
 ile_type(st.st_mode), 
(unsigned long)st.st_ino); 
return 0; 
} 

--------------------------------------- 
Q.2) Write a C program which creates a child process to run linux/ unix command or 
any user defined program. The parent process set the signal handler for death of child 
signal and Alarm signal. If a child process does not complete its execution in 5 second 
then parent process kills child process [20 Marks ]
-------------------------------------------------------------- 
#include <stdio.h> 
#include <stdlib.h> 
#include <unistd.h> 
#include <signal.h> 
#include <sys/wait.h> 
pid_t child_pid = -1; 
void handle_sigchld(int sig) { 
printf("Parent: Child process terminated (SIGCHLD received)\n"); 
} 
void handle_sigalrm(int sig) { 
printf("Parent: Child process did not finish in 5 seconds. Killing child!\n"); 
if (child_pid > 0) { 
kill(child_pid, SIGKILL); 
} 
} 
int main(int argc, char *argv[]) { 
if (argc < 2) { 
printf("Usage: %s <command> [args ...]\n", argv[0]); 
exit(1); 
} 
    signal(SIGCHLD, handle_sigchld); 
    signal(SIGALRM, handle_sigalrm); 
 
    child_pid = fork(); 
    if (child_pid < 0) { 
        perror("fork"); 
        exit(1); 
    } 
 
    if (child_pid == 0) { 
         
        execvp(argv[1], &argv[1]); 
        perror("execvp failed"); 
        exit(1); 
    } else { 
               alarm(5);         int status; 
        waitpid(child_pid, &status, 0); 
 
        alarm(0);  
        if (WIFEXITED(status)) { 
            printf("Child exited with status %d\n", WEXITSTATUS(status)); 
        } else if (WIFSIGNALED(status)) { 
            printf("Child killed by signal %d\n", WTERMSIG(status)); 
        } 
    } 
return 0; 
} 
